<div class="container pt-3 mb-2">
  <div class="page-header">
    <div></div>
    <h3>{{ currentProgram()?.name }}</h3>
    <div class="help-icon">
      <mat-icon
        fontSet="material-symbols-outlined"
        matTooltip="Help"
        (click)="showHelp()"
        >help</mat-icon
      >
    </div>
  </div>
  <div class="filters-1 mb-2">
    <mat-form-field appearance="fill" subscriptSizing="dynamic">
      <mat-label>Search by name</mat-label>
      <input matInput [(ngModel)]="nameFilter" />
    </mat-form-field>
    <mat-form-field appearance="fill" subscriptSizing="dynamic">
      <mat-label>Select team</mat-label>
      <mat-select #teamSelect [(ngModel)]="selectedTeamId">
        @for (team of teams(); track team.id) {
        <mat-option [value]="team.id">{{ team.name }}</mat-option>
        }
      </mat-select>
      @if (selectedTeamId() !== '') {
      <button
        matSuffix
        tabindex="-1"
        mat-icon-button
        aria-label="Clear"
        [appClearSelect]="teamSelect"
      >
        <mat-icon>close</mat-icon>
      </button>
      }
    </mat-form-field>
    <mat-slide-toggle
      class="active-toggle"
      [checked]="true"
      [(ngModel)]="activeOnly"
      >Active only</mat-slide-toggle
    >
  </div>
  <div class="filters-2">
    <button mat-flat-button (click)="createPlayer()">Create New Player</button>
    <button mat-flat-button (click)="addPlayers()">Add Existing Players</button>
  </div>
</div>
<div class="table-container">
  <div class="scrollable-tale mat-elevation-z8">
    <table
      mat-table
      matSort
      [dataSource]="filteredPlayers()"
      (matSortChange)="sortPlayers($event)"
    >
      @let columnsToDisplay = ['firstName', 'lastName', 'gender', 'age',
      'tryoutNumber', 'jerseyNumber', 'evalScore', 'looks', 'goalie', 'team',
      'usaHockeyNumber', 'active'];
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>Id</th>
        <td mat-cell *matCellDef="let player">{{ player.id }}</td>
      </ng-container>
      <ng-container matColumnDef="firstName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>First Name</th>
        <td mat-cell *matCellDef="let player">{{ player.firstName }}</td>
      </ng-container>
      <ng-container matColumnDef="lastName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Name</th>
        <td mat-cell *matCellDef="let player">{{ player.lastName }}</td>
      </ng-container>
      <ng-container matColumnDef="gender">
        <th mat-header-cell *matHeaderCellDef>Gender</th>
        <td mat-cell *matCellDef="let player">{{ player.gender }}</td>
      </ng-container>
      <ng-container matColumnDef="age">
        <th mat-header-cell *matHeaderCellDef>DoB/Age</th>
        <td mat-cell *matCellDef="let player">
          {{ player.birthDate | date : "yyyy-MM-dd" }}({{ player.age }})
        </td>
      </ng-container>
      <ng-container matColumnDef="tryoutNumber">
        <th mat-header-cell *matHeaderCellDef>Tryout Number</th>
        <td mat-cell *matCellDef="let player">{{ player.tryoutNumber }}</td>
      </ng-container>
      <ng-container matColumnDef="jerseyNumber">
        <th mat-header-cell *matHeaderCellDef>Jersey Number</th>
        <td mat-cell *matCellDef="let player">{{ player.jerseyNumber }}</td>
      </ng-container>
      <ng-container matColumnDef="evalScore">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          Evaluation Score
        </th>
        <td mat-cell *matCellDef="let player">{{ player.evalScore }}</td>
      </ng-container>
      <ng-container matColumnDef="looks">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Looks</th>
        <td mat-cell *matCellDef="let player">{{ player.looks }}</td>
      </ng-container>
      <ng-container matColumnDef="goalie">
        <th mat-header-cell *matHeaderCellDef>Goalie</th>
        <td mat-cell *matCellDef="let player">{{ player.goalie }}</td>
      </ng-container>
      <ng-container matColumnDef="team">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Team</th>
        <td mat-cell *matCellDef="let player">
          {{ getTeamName(player.teamId) }}
        </td>
      </ng-container>
      <ng-container matColumnDef="usaHockeyNumber">
        <th mat-header-cell *matHeaderCellDef>USA Hockey Number</th>
        <td mat-cell *matCellDef="let player">{{ player.usaHockeyNumber }}</td>
      </ng-container>
      <ng-container matColumnDef="active">
        <th mat-header-cell *matHeaderCellDef>Active</th>
        <td mat-cell *matCellDef="let player">{{ player.active | yesNo }}</td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="columnsToDisplay; sticky: true"></tr>
      <tr
        mat-row
        *matRowDef="let player; columns: columnsToDisplay"
        (click)="onRowClick(player)"
        class="clickable-row"
      ></tr>
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [colSpan]="columnsToDisplay.length">
          No players found matching the search criteria.
        </td>
      </tr>
    </table>
  </div>
</div>
